# ADR-002: Extraction des templates email vers Infrastructure

**Date**: 2024-12-12  
**Statut**: Accepté  
**Auteur**: Claude-Architect-Ω

## Contexte

Le service `EmailService` contenait plus de 300 lignes de templates HTML inline, mélangeant logique métier et présentation.

### Problèmes identifiés

1. **Violation SRP** : Le service applicatif gérait à la fois l'envoi d'emails ET le rendu des templates
2. **Maintenabilité** : Modifier un template nécessitait de toucher au code applicatif
3. **Testabilité** : Impossible de tester les templates indépendamment

## Décision

Créer un `TemplateAdapter` dans la couche Infrastructure :

- **Localisation** : `src/infrastructure/templates/template.adapter.ts`
- **Pattern** : Adapter (Infrastructure Layer)
- **Interface** : `render(templateName: string, context: TemplateContext): string`

### Approche minimale choisie

Pour cette première itération, les templates restent dans le code TypeScript plutôt que dans des fichiers `.hbs` séparés. Cela permet de :

1. Éviter d'ajouter une dépendance (Handlebars)
2. Conserver le typage TypeScript pour les variables
3. Migrer progressivement sans breaking change

## Alternatives considérées

### Handlebars avec fichiers .hbs
- **Avantages** : Séparation complète, édition par non-développeurs
- **Inconvénients** : Nouvelle dépendance, perte de typage
- **Décision** : Reporter à une future itération si le besoin se confirme

### EJS
- **Avantages** : Syntaxe proche de JS
- **Inconvénients** : Moins populaire que Handlebars
- **Décision** : Non retenu

## Conséquences

### Positives
- Templates centralisés dans un seul fichier
- `EmailService` délègue le rendu à l'adaptateur
- Facilite les tests unitaires des templates

### Négatives
- Templates toujours en TypeScript (pas encore en fichiers séparés)
- Nécessite une compilation pour modifier un template

## Migration future

Pour une extraction complète vers des fichiers `.hbs` :

1. Installer `handlebars` et `@types/handlebars`
2. Créer les fichiers dans `src/infrastructure/templates/email/*.hbs`
3. Modifier `TemplateAdapter.render()` pour charger les fichiers

## Rollback

```bash
git revert <commit-sha>
# Restaurer l'ancien EmailService avec templates inline
```